platform:
  - x86
  - x64
  
configuration:
  - Release

os:
  - Visual Studio 2015 RC
  
build_script:
    # TODO Is set but never used anywhere. Wrong environment variable? use PATH instead??
  - setx CMAKE_LIBRARY_PATH "C:\OpenSSL-Win32\lib\VC;%CMAKE_LIBRARY_PATH%"
  - setx PATH "C:\OpenSSL-Win32\lib\VC;%PATH%"
  - md build
  - cd build
  - cmake --version
  - cmake -DBUILD_TESTING=ON -DTEST_OUTPUT_CONSOLE=ON -G"Visual Studio 14 2015" -DCMAKE_LIBRARY_PATH="C:\OpenSSL-Win32\lib\VC" ..
  - cmake --build .
  
after_build:
  - ps: Push-AppveyorArtifact build\Debug\OHMCommStandalone.exe -FileName "OHMCommStandalone-win-$env:platform.exe"

#test_script:
#  - .\build\test\Debug\Tests.exe

#artifacts:
#  - path: '**\OHMComm.exe'
#    name: OHMComm-win-$(platform)

deploy:
- provider: GitHub
  description: 'Windows builds'
  draft: false
  prerelease: false
  artifact: OHMCommStandalone-win-$(platform).exe
  auth_token:
    secure: fIObA1SGSxF/oK69Deh0D7eTmdJirubBGCjbHDn7EA7M4mP2AdkHDEheW77PTPge
  on:
    #branch: master
    appveyor_repo_tag: true

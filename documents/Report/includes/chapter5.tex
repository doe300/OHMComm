\chapter{Prototypische Voice-over-IP Konsolenanwendungen}
\label{prototypProgram}
\section{Ziel der Anwendung}
\section{Steuerung}
\section{Anwendungen ordnungsgemäß beenden}
Ein größeres Problem bei der Umsetzung der prototypischen Konsolenanwendung ist es gewesen, die Anwendung ordnungsgemäß zu beenden. Besonders problematisch wird es, da die Anwendung aus verschiedenen Threads besteht, die alle beendet werden müssen, sowie die Kommunikation selber aus verschiedenen Threads heraus beendet werden kann. So müssen folgende Threads beendet werden: Der Thread der Verarbeitungskette, der von der Audioschnittstelle heraus gestartet wird, der RTPListener-Thread und der RTCP-Thread, die beide vom \texttt{OHMComm}-Objekt erzeugt werden. Ebenso muss der \texttt{NetworkWrapper} geschlossen werden, da dieser auch verbindungsorientiert (z.B. mit TCP) implementiert werden kann. Beendet werden kann das Framework an folgenden Stellen: von Extern (z.B. der verwendenden Anwendung) und durch den RTCP-Thread (beim Empfangen eines \texttt{BYE}-Pakets). Daher muss dafür gesorgt werden, dass sowohl der aufrufende Code als auch der RTCP-Thread Zugriff auf die \texttt{stopAudioThreads()}-Methode des \texttt{OHMComm}-Objekts haben. Dafür wird dem RTCP-Thread ein Funktionsobjekt mitgegeben, das die \texttt{stopAudioThreads()}-Methode aufruft, die dafür sorgt, dass alle vom Framework erstellten Threads und Resource-Handler ordnungsgemäß beendet und geschlossen werden.
\\
Somit kann die Kommunikation im OMHComm-Framework durch den Aufruf der \texttt{stopAudioThreads()}-Methode aus allen Stellen, die Zugriff darauf haben ordnungsgemäß und vollständig beendet werden. Jedoch wird die Kommunikation im Framework durch einen nicht blockierenden Methodenaufruf auf \texttt{startAudioThreads()} gestartet, damit der aufrufende Thread weitere Tätigkeiten ausführen kann. Da aber ein Programm automatisch beendet wird, wenn die \texttt{main()}-Funktion ihr Ende erreicht, muss für die prototypische Konsolenanwendung der Haupt-Thread nach dem Start der Kommunikation solange schlafen gelegt werden, bis die Kommunikation beendet wird. Dafür wird in der \texttt{main()}-Funktion blockierend auf eine Benutzereingabe gewartet und nach dieser Eingabe die Kommunikation und schließlich das Programm beendet. Wird jedoch die Kommunikation über einen anderen Weg (z.B. durch das Empfangen eines RTCP \texttt{BYE}-Pakets) beendet, wartet der Haupt-Thread weiterhin auf eine Benutzereingabe und somit läuft das Konsolenprogramm weiter. Deshalb muss derzeit die Konsolenanwendung immer mit einer Benutzereingabe (beliebige Zeichen, die mit einem \enquote{Enter} abgesendet werden) beendet werden.